!function(n,t){function e(n){if(n instanceof Array)return{path:n,str:n.join(".")};if("string"==typeof n)return{path:n.split("."),str:n}}function s(n,t){if(0!==t.length&&void 0!==n){var s=e(t);if(s){t=s.path;for(var i=0;i<t.length;i++)if(n=n[t[i]],void 0===n)return;return n}}}function i(n,t,e){return Object.defineProperty(n,t,{enumerable:!1,value:e}),e}n&&(t=module.exports);var r=n?process.nextTick:t.requestAnimationFrame,a=0,c={jobs:{},_signed:{},subscriptions:{},scheduled:!1,__subscribers:function(n){for(var t in n)if(n.hasOwnProperty(t)){n[t].fn.apply(null,[n[t].values])}},__digest:function(){var n=this;n.scheduled===!1&&(n.scheduled=!0,r(function(){n.scheduled=!1;for(var t in n.jobs)n.jobs[t](),delete n.jobs[t];var e={};for(var t in n._signed){var s=n._signed[t],i=s.target();if(s.signed.apply(null,i),n.subscriptions[t]){var r=n.subscriptions[t].$id;e[r]=e[r]||{values:{},fn:n.subscriptions[t]},e[r].values[s.signed.$path]=i[0]}delete n._signed[t]}n.__subscribers(e)}))},signFunction:function(n){n.$id=n.$id||a++},subscribe:function(n,t){this.signFunction(t);for(var e=0;e<n.length;e++){var s=n[e];this.subscriptions[s.fn.$id]=t}},unsubscribe:function(n){for(var t=0;t<n.length;t++){var e=n[t];delete this.subscriptions[e.fn.$id]}},sign:function(n,t){return this.signFunction(n),n.$instant?n.apply(null,t()):(this._signed[n.$id]={target:t,signed:n},this.__digest())},cancel:function(n){delete this._signed[n.$id]},add:function(n,t,e){return t=e?t.bind(e):t,this.jobs[n]=t,this.__digest()}},u=function(n,t){return c.subscribe(n,t),{unsubscribe:function(){return c.unsubscribe(n)},destroy:function(){c.unsubscribe(n);for(var t in n){var e=n[t];e.destroy()}}}},o=0,f=function(n,t,r,u){if("object"==typeof n&&"function"==typeof r){var d=e(t);if(d){r.$id=r.$id||a++,u&&(r.$instant=!0);var p=d.path,l=d.str;r.$path=l;for(var h=p[0],$=[],v=0;v<p.length;v++)$.push(p[v]);var b,g=$.splice(1,$.length),y=g.join("."),_=h===l,j=n.$$p;j||(i(n,"$$p",{}),j=n.$$p,i(j,"$properties",{}),i(j,"$id",++o)),void 0===b&&(b=j.$id);var k=j.$properties[h];if(!k){k=j.$properties[h]={$self:[],$descendants:{}};var m=n[h];Object.defineProperty(n,h,{get:function(){return m},set:function(n){return A(n,m),m=n}});var A=function(n,t){for(var e in k.$descendants)if(k.$descendants.hasOwnProperty(e)){for(var i in k.$descendants[e].callbacks){var r=k.$descendants[e].callbacks[i];c.sign(r,function(){return[s(n,e),t]})}c.add(b+e,function(){k.$descendants[this.key].bindWatcher()},{key:e})}if(_)for(var i=0;i<k.$self.length;i++){var a=k.$self[i];a.$path&&"object"==typeof t&&(t=s(t,a.$path)),c.sign(a,function(){return[n,t]})}}}_?(c.sign(r,function(){return[n[h]]}),k.$self.push(r)):(k.$descendants[y]?k.$descendants[y].callbacks.push(r):(k.$descendants[y]={callbacks:[r],bindWatcher:function(){n.hasOwnProperty(h)&&void 0!==n[h]&&f(n[h],g,function(n,t){for(var e=0;e<k.$descendants[y].callbacks.length;e++){var s=k.$descendants[y].callbacks[e];c.sign(s,function(){return[n,t]})}},!0)}},k.$descendants[y].bindWatcher()),c.sign(r,function(){return[s(n[h],g)]}));var w=k.$descendants[y];return{fn:r,destroy:function(){if(w){var n=w.callbacks.indexOf(r);n>-1&&w.callbacks.splice(n,1)}if(k.$self){var t=k.$self.indexOf(r);t>-1&&k.$self.splice(n,1)}}}}}},d=function(n,t,e,s){var r=[];return f(n,t,function(n,t){n.$$p||(n.$$p=p=i(n,"$pp",{}));var s=n.$$p.array;return s||(s=i(p,"array",{})),s.watchers||(s.watchers=i(s,"fn",[])),s.watchers.push(e),s.init||(s.init=!0,s.changed=function(t){if(t.length>0)for(var e=0;e<s.watchers.length;e++)s.watchers[e](n,r);r=[]},n.push=function(){Array.prototype.push.apply(this,arguments);var n=arguments;r.push({name:"push",data:n}),c.sign(s.changed,function(){return[r]})},n.splice=function(){var n=arguments;Array.prototype.splice.apply(this,arguments),r.push({name:"splice",data:n}),c.sign(s.changed,function(){return[r]})},n.unshift=function(){var n=arguments;Array.prototype.unshift.apply(this,n),r.push({name:"unshift",data:n}),c.sign(s.changed,function(){return[r]})}),r=[],e(n,[{name:"init"}])})};f.subscribe=u,t.AsyncWatch=f,t.AsyncWatchArray=d,t.AsyncTransaction=c}("undefined"!=typeof module&&module.exports,this);