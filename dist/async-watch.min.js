!function(n,e){function s(n){if(n instanceof Array)return{path:n,str:n.join(".")};if("string"==typeof n)return{path:n.split("."),str:n}}function t(n,e){if(0!==e.length&&void 0!==n){var t=s(e);if(t){e=t.path;for(var i=0;i<e.length;i++)if(n=n[e[i]],void 0===n)return;return n}}}function i(n,e,s){return Object.defineProperty(n,e,{enumerable:!1,value:s}),n}n&&(e=module.exports);var r=n?process.nextTick:e.requestAnimationFrame,a=0,c={jobs:{},_signed:{},subscriptions:{},scheduled:!1,__subscribers:function(n){for(var e in n)if(n.hasOwnProperty(e)){n[e].fn.apply(null,[n[e].values])}},__digest:function(){var n=this;n.scheduled===!1&&(n.scheduled=!0,r(function(){for(var e in n.jobs)n.jobs[e](),delete n.jobs[e];var s={};for(var e in n._signed){var t=n._signed[e],i=t.target();if(t.signed.apply(null,i),n.subscriptions[e]){var r=n.subscriptions[e].$id;s[r]=s[r]||{values:{},fn:n.subscriptions[e]},s[r].values[t.signed.$path]=i[0]}delete n._signed[e]}n.__subscribers(s),n.scheduled=!1}))},signFunction:function(n){n.$id=n.$id||a++},subscribe:function(n,e){this.signFunction(e);for(var s=0;s<n.length;s++){var t=n[s];this.subscriptions[t.$id]=e}},unsubscribe:function(n){for(var e=0;e<n.length;e++){var s=n[e];delete this.subscriptions[s.$id]}},sign:function(n,e){return this.signFunction(n),n.$instant?n.apply(null,e()):(this._signed[n.$id]={target:e,signed:n},this.__digest())},add:function(n,e,s){return e=s?e.bind(s):e,this.jobs[n]=e,this.__digest()}},u=function(n,e){var s=[];for(var t in n)if(arguments.hasOwnProperty(t)){var i=n[t];s.push(i.fn)}return c.subscribe(s,e),{unsubscribe:function(){return c.unsubscribe(s)}}},o=function(n){this.fn=n},d=0,f=function(n,e,r,u){if("object"==typeof n&&"function"==typeof r){var l=s(e);if(l){r.$id?r.$id:a++;var p=new o(r);u&&(r.$instant=!0);var h=l.path,b=l.str;r.$path=b;for(var v=h[0],$=[],g=0;g<h.length;g++)$.push(h[g]);var y,_=$.splice(1,$.length),j=_.join("."),k=v===b,m=n.$$p;m||(i(n,"$$p",{}),m=n.$$p,i(m,"$properties",{}),i(m,"$id",++d)),void 0===y&&(y=m.$id);var O=m.$properties[v];if(!O){O=m.$properties[v]={$self:[],$descendants:{}};var P=n[v];Object.defineProperty(n,v,{get:function(){return P},set:function(n){return w(n,P),P=n}});var w=function(n,e){for(var s in O.$descendants)if(O.$descendants.hasOwnProperty(s)){for(var i in O.$descendants[s].callbacks){var r=O.$descendants[s].callbacks[i];c.sign(r,function(){return[t(n,s),e]})}c.add(y+s,function(){O.$descendants[this.key].bindWatcher()},{key:s})}if(k)for(var i=0;i<O.$self.length;i++){var a=O.$self[i];c.sign(a,function(){return[n,e]})}}}return k?(c.sign(r,function(){return[n[v]]}),O.$self.push(r)):(O.$descendants[j]?O.$descendants[j].callbacks.push(r):(O.$descendants[j]={callbacks:[r],bindWatcher:function(){n.hasOwnProperty(v)&&void 0!==n[v]&&f(n[v],_,function(n,e){for(var s=0;s<O.$descendants[j].callbacks.length;s++){var t=O.$descendants[j].callbacks[s];c.sign(t,function(){return[n,e]})}},!0)}},O.$descendants[j].bindWatcher()),c.sign(r,function(){return[t(n[v],_)]})),p}}};f.subscribe=u,e.AsyncWatch=f,e.AsyncTransaction=c}("undefined"!=typeof module&&module.exports,this);