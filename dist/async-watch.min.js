!function(n,s){function e(n){if(n instanceof Array)return{path:n,str:n.join(".")};if("string"==typeof n)return{path:n.split("."),str:n}}function i(n,s){if(0!==s.length&&void 0!==n){var i=e(s);if(i){s=i.path;for(var t=0;t<s.length;t++)if(n=n[s[t]],void 0===n)return;return n}}}function t(n,s,e){return Object.defineProperty(n,s,{enumerable:!1,value:e}),n}n&&(s=module.exports);var r=n?process.nextTick:s.requestAnimationFrame,a=0,c={jobs:{},_signed:{},subscriptions:{},scheduled:!1,__subscribers:function(n){for(var s in n)if(n.hasOwnProperty(s)){var e={};for(var i in n[s].args){var t=n[s].args[i];if("object"==typeof t)for(var r in t)e[r]=t[r]}n[s].fn.apply(null,[e])}},__digest:function(){var n=this;n.scheduled===!1&&(n.scheduled=!0,r(function(){for(var s in n.jobs)n.jobs[s](),delete n.jobs[s];var e={};for(var s in n._signed){var i=n._signed[s],t=i.signed.apply(null,i.target());if(n.subscriptions[s]){var r=n.subscriptions[s].$id;e[r]=e[r]||{args:[],fn:n.subscriptions[s]},e[r].args.push(t)}delete n._signed[s]}n.__subscribers(e),n.scheduled=!1}))},signFunction:function(n){n.$id=n.$id||a++},subscribe:function(n,s){this.signFunction(s);for(var e=0;e<n.length;e++){var i=n[e];this.subscriptions[i.$id]=s}},unsubscribe:function(n){for(var s=0;s<n.length;s++){var e=n[s];delete this.subscriptions[e.$id]}},sign:function(n,s){return this.signFunction(n),n.$instant?n.apply(null,s()):(this._signed[n.$id]={target:s,signed:n},this.__digest())},add:function(n,s,e){return s=e?s.bind(e):s,this.jobs[n]=s,this.__digest()}},o=function(n,s){var e=[];for(var i in n)if(arguments.hasOwnProperty(i)){var t=n[i];e.push(t.fn)}return c.subscribe(e,s),{unsubscribe:function(){return c.unsubscribe(e)}}},u=function(n){this.fn=n},d=0,f=function(n,s,r,o){if("object"==typeof n&&"function"==typeof r){var l=e(s);if(l){r.$id?r.$id:a++;var p=new u(r);o&&(r.$instant=!0);for(var b=l.path,h=l.str,v=b[0],$=[],g=0;g<b.length;g++)$.push(b[g]);var y,_=$.splice(1,$.length),j=_.join("."),k=v===h,m=n.$$p;m||(t(n,"$$p",{}),m=n.$$p,t(m,"$properties",{}),t(m,"$id",++d)),void 0===y&&(y=m.$id);var O=m.$properties[v];if(!O){O=m.$properties[v]={$self:[],$descendants:{}};var P=n[v];Object.defineProperty(n,v,{get:function(){return P},set:function(n){return w(n,P),P=n}});var w=function(n,s){for(var e in O.$descendants)if(O.$descendants.hasOwnProperty(e)){for(var t in O.$descendants[e].callbacks){var r=O.$descendants[e].callbacks[t];c.sign(r,function(){return[i(n,e),s]})}c.add(y+e,function(){O.$descendants[this.key].bindWatcher()},{key:e})}if(k)for(var t=0;t<O.$self.length;t++){var a=O.$self[t];c.sign(a,function(){return[n,s]})}}}return k?(c.sign(r,function(){return[n[v]]}),O.$self.push(r)):(O.$descendants[j]?O.$descendants[j].callbacks.push(r):(O.$descendants[j]={callbacks:[r],bindWatcher:function(){n.hasOwnProperty(v)&&void 0!==n[v]&&f(n[v],_,function(n,s){for(var e=0;e<O.$descendants[j].callbacks.length;e++){var i=O.$descendants[j].callbacks[e];c.sign(i,function(){return[n,s]})}},!0)}},O.$descendants[j].bindWatcher()),c.sign(r,function(){return[i(n[v],_)]})),p}}};f.subscribe=o,s.AsyncWatch=f,s.AsyncTransaction=c}("undefined"!=typeof module&&module.exports,this);