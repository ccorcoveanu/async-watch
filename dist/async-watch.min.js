!function(n,t){function s(n){if(n instanceof Array)return{path:n,str:n.join(".")};if("string"==typeof n)return{path:n.split("."),str:n}}function e(n,t){if(0!==t.length&&void 0!==n){var e=s(t);if(e){t=e.path;for(var i=0;i<t.length;i++)if(n=n[t[i]],void 0===n)return;return n}}}function i(n,t,s){return Object.defineProperty(n,t,{enumerable:!1,value:s}),s}var r;n?t=module.exports:(t.__npm__=t.__npm__||{},r=t.__npm__["async-watch"]={});var a=n?process.nextTick:t.requestAnimationFrame,c=0,u={jobs:{},_signed:{},subscriptions:{},scheduled:!1,__subscribers:function(n){for(var t in n)if(n.hasOwnProperty(t)){n[t].fn.apply(null,[n[t].values])}},__digest:function(){var n=this;n.scheduled===!1&&(n.scheduled=!0,a(function(){n.scheduled=!1;for(var t in n.jobs)n.jobs[t](),delete n.jobs[t];var s={};for(var t in n._signed){var e=n._signed[t],i=e.target();if(e.signed.apply(null,i),n.subscriptions[t]){var r=n.subscriptions[t].$id;s[r]=s[r]||{values:{},fn:n.subscriptions[t]},s[r].values[e.signed.$path]=i[0]}delete n._signed[t]}n.__subscribers(s)}))},signFunction:function(n){n.$id=n.$id||c++},subscribe:function(n,t){this.signFunction(t);for(var s=0;s<n.length;s++){var e=n[s];this.subscriptions[e.fn.$id]=t}},unsubscribe:function(n){for(var t=0;t<n.length;t++){var s=n[t];delete this.subscriptions[s.fn.$id]}},sign:function(n,t){return this.signFunction(n),n.$instant?n.apply(null,t()):(this._signed[n.$id]={target:t,signed:n},this.__digest())},cancel:function(n){delete this._signed[n.$id]},add:function(n,t,s){return t=s?t.bind(s):t,this.jobs[n]=t,this.__digest()}},o=function(n,t){return u.subscribe(n,t),{unsubscribe:function(){return u.unsubscribe(n)},destroy:function(){u.unsubscribe(n);for(var t in n){var s=n[t];s.destroy()}}}},f=0,d=function(n,t,r,a){if("object"==typeof n&&"function"==typeof r){var o=s(t);if(o){r.$id=r.$id||c++,a&&(r.$instant=!0);var p=o.path,h=o.str;r.$path=h;for(var l=p[0],$=[],b=0;b<p.length;b++)$.push(p[b]);var v,g=$.splice(1,$.length),y=g.join("."),_=l===h,A=n.$$p;A||(i(n,"$$p",{}),A=n.$$p,i(A,"$properties",{}),i(A,"$id",++f)),void 0===v&&(v=A.$id);var m=A.$properties[l];if(!m){m=A.$properties[l]={$self:[],$descendants:{}};var j=n[l];Object.defineProperty(n,l,{get:function(){return j},set:function(n){return k(n,j),j=n}});var k=function(n,t){for(var s in m.$descendants)if(m.$descendants.hasOwnProperty(s)){for(var i in m.$descendants[s].callbacks){var r=m.$descendants[s].callbacks[i];u.sign(r,function(){return[e(n,s),t]})}u.add(v+s,function(){m.$descendants[this.key].bindWatcher()},{key:s})}if(_)for(var i=0;i<m.$self.length;i++){var a=m.$self[i];a.$path&&"object"==typeof t&&(t=e(t,a.$path)),u.sign(a,function(){return[n,t]})}}}_?(u.sign(r,function(){return[n[l]]}),m.$self.push(r)):(m.$descendants[y]?m.$descendants[y].callbacks.push(r):(m.$descendants[y]={callbacks:[r],bindWatcher:function(){n.hasOwnProperty(l)&&void 0!==n[l]&&d(n[l],g,function(n,t){for(var s=0;s<m.$descendants[y].callbacks.length;s++){var e=m.$descendants[y].callbacks[s];u.sign(e,function(){return[n,t]})}},!0)}},m.$descendants[y].bindWatcher()),u.sign(r,function(){return[e(n[l],g)]}));var w=m.$descendants[y];return{fn:r,destroy:function(){if(w){var n=w.callbacks.indexOf(r);n>-1&&w.callbacks.splice(n,1)}if(m.$self){var t=m.$self.indexOf(r);t>-1&&m.$self.splice(n,1)}}}}}},h=function(n,t,s,e){var r=[];return d(n,t,function(n,t){n.$$p||(n.$$p=p=i(n,"$pp",{}));var e=n.$$p.array;return e||(e=i(p,"array",{})),e.watchers||(e.watchers=i(e,"fn",[])),e.watchers.push(s),e.init||(e.init=!0,e.changed=function(t){if(t.length>0)for(var s=0;s<e.watchers.length;s++)e.watchers[s](n,r);r=[]},n.push=function(){Array.prototype.push.apply(this,arguments);var n=arguments;r.push({name:"push",data:n}),u.sign(e.changed,function(){return[r]})},n.splice=function(){var n=arguments;Array.prototype.splice.apply(this,arguments),r.push({name:"splice",data:n}),u.sign(e.changed,function(){return[r]})},n.unshift=function(){var n=arguments;Array.prototype.unshift.apply(this,n),r.push({name:"unshift",data:n}),u.sign(e.changed,function(){return[r]})}),r=[],s(n,[{name:"init"}])})};d.subscribe=o,t.AsyncWatch=d,t.AsyncSubscribe=o,t.AsyncWatchArray=h,t.AsyncTransaction=u,r&&(r.AsyncWatch=d,r.AsyncSubscribe=AsyncSubscribe,r.AsyncWatchArray=h,r.AsyncTransaction=u)}("undefined"!=typeof module&&module.exports,this);