"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol?"symbol":typeof n};!function(n,t){function e(n){if(n instanceof Array)return{path:n,str:n.join(".")};if("string"==typeof n)return{path:n.split("."),str:n}}function i(n,t){if(0!==t.length&&void 0!==n){var i=e(t);if(i){t=i.path;for(var s=0;s<t.length;s++)if(n=n[t[s]],void 0===n)return;return n}}}function s(n,t,e){return Object.defineProperty(n,t,{enumerable:!1,value:e}),e}var r;n?t=module.exports:(t.__npm__=t.__npm__||{},r=t.__npm__["async-watch"]={});var a=n?process.nextTick:t.requestAnimationFrame,c=0,o={jobs:{},_signed:{},subscriptions:{},scheduled:!1,__subscribers:function(n){for(var t in n)if(n.hasOwnProperty(t)){n[t].fn.apply(null,[n[t].values])}},__digest:function(){var n=this;n.scheduled===!1&&(n.scheduled=!0,a(function(){n.scheduled=!1;for(var t in n.jobs)n.jobs[t](),delete n.jobs[t];var e={};for(var t in n._signed){var i=n._signed[t],s=i.target();if(i.signed.apply(null,s),n.subscriptions[t]){var r=n.subscriptions[t].$id;e[r]=e[r]||{values:{},fn:n.subscriptions[t]},e[r].values[i.signed.$path]=s[0]}delete n._signed[t]}n.__subscribers(e)}))},signFunction:function(n){n.$id=n.$id||c++},subscribe:function(n,t){this.signFunction(t);for(var e=0;e<n.length;e++){var i=n[e];this.subscriptions[i.fn.$id]=t}},unsubscribe:function(n){for(var t=0;t<n.length;t++){var e=n[t];delete this.subscriptions[e.fn.$id]}},sign:function(n,t){return this.signFunction(n),n.$instant?n.apply(null,t()):(this._signed[n.$id]={target:t,signed:n},this.__digest())},cancel:function(n){delete this._signed[n.$id]},add:function(n,t,e){return t=e?t.bind(e):t,this.jobs[n]=t,this.__digest()}},u=function(n,t){return o.subscribe(n,t),{unsubscribe:function(){return o.unsubscribe(n)},destroy:function(){o.unsubscribe(n);for(var t in n){var e=n[t];e.destroy()}}}},f=0,d=function y(n,t,r,a){if("object"===("undefined"==typeof n?"undefined":_typeof(n))&&"function"==typeof r){var u=e(t);if(u){r.$id=r.$id||c++,a&&(r.$instant=!0);var p=u.path,d=u.str;r.$path=d;for(var l=p[0],h=[],b=0;b<p.length;b++)h.push(p[b]);var v,$=h.splice(1,h.length),g=$.join("."),_=l===d,m=n.$$p;m||(s(n,"$$p",{}),m=n.$$p,s(m,"$properties",{}),s(m,"$id",++f)),void 0===v&&(v=m.$id);var A=m.$properties[l];if(!A){A=m.$properties[l]={$self:[],$descendants:{}};var k=n[l];Object.defineProperty(n,l,{get:function(){return k},set:function(n){return w(n,k),k=n}});var w=function(n,t){for(var e in A.$descendants)if(A.$descendants.hasOwnProperty(e)){for(var s in A.$descendants[e].callbacks){var r=A.$descendants[e].callbacks[s];o.sign(r,function(){return[i(n,e),t]})}o.add(v+e,function(){A.$descendants[this.key].bindWatcher()},{key:e})}if(_)for(var s=0;s<A.$self.length;s++){var a=A.$self[s];a.$path&&"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(t=i(t,a.$path)),o.sign(a,function(){return[n,t]})}}}_?(o.sign(r,function(){return[n[l]]}),A.$self.push(r)):(A.$descendants[g]?A.$descendants[g].callbacks.push(r):(A.$descendants[g]={callbacks:[r],bindWatcher:function(){n.hasOwnProperty(l)&&void 0!==n[l]&&y(n[l],$,function(n,t){for(var e=0;e<A.$descendants[g].callbacks.length;e++){var i=A.$descendants[g].callbacks[e];o.sign(i,function(){return[n,t]})}},!0)}},A.$descendants[g].bindWatcher()),o.sign(r,function(){return[i(n[l],$)]}));var j=A.$descendants[g];return{fn:r,destroy:function(){if(j){var n=j.callbacks.indexOf(r);n>-1&&j.callbacks.splice(n,1)}if(A.$self){var t=A.$self.indexOf(r);t>-1&&A.$self.splice(n,1)}}}}}},l=function(){function n(){_classCallCheck(this,n),this.initialize?this.initialize():"";var t=[],e=this;for(var i in this){if(this.hasOwnProperty(i)){var s=d(this,i,function(){"on"+this.propertyName.charAt(0).toUpperCase()+this.propertyName.slice(1)}.bind({propertyName:i}));t.push(s)}this.$subscription=u(t,function(n){"function"==typeof e.onChanges&&e.onChanges(n),"function"==typeof e.__listener&&e.__listener(n)})}}return _createClass(n,[{key:"listen",value:function(n){this.__listener=n}}]),n}(),h=function(n,t,e,i){var r=[];return d(n,t,function(n,t){n.$$p||(n.$$p=p=s(n,"$pp",{}));var i=n.$$p.array;return i||(i=s(p,"array",{})),i.watchers||(i.watchers=s(i,"fn",[])),i.watchers.push(e),i.init||(i.init=!0,i.changed=function(t){if(t.length>0)for(var e=0;e<i.watchers.length;e++)i.watchers[e](n,r);r=[]},n.push=function(){Array.prototype.push.apply(this,arguments);var n=arguments;r.push({name:"push",data:n}),o.sign(i.changed,function(){return[r]})},n.splice=function(){var n=arguments;Array.prototype.splice.apply(this,arguments),r.push({name:"splice",data:n}),o.sign(i.changed,function(){return[r]})},n.unshift=function(){var n=arguments;Array.prototype.unshift.apply(this,n),r.push({name:"unshift",data:n}),o.sign(i.changed,function(){return[r]})}),r=[],e(n,[{name:"init"}])},i)};d.subscribe=u,t.AsyncWatch=d,t.AsyncSubscribe=u,t.AsyncWatchArray=h,t.AsyncModel=l,t.AsyncTransaction=o,r&&(r.AsyncWatch=d,r.AsyncSubscribe=AsyncSubscribe,r.AsyncWatchArray=h,r.AsyncTransaction=o,r.AsyncModel=l)}("undefined"!=typeof module&&module.exports,this);