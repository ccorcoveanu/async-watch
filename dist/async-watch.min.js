!function(n,t){function e(n){if(n instanceof Array)return{path:n,str:n.join(".")};if("string"==typeof n)return{path:n.split("."),str:n}}function s(n,t){if(0!==t.length&&void 0!==n){var s=e(t);if(s){t=s.path;for(var i=0;i<t.length;i++)if(n=n[t[i]],void 0===n)return;return n}}}function i(n,t,e){return Object.defineProperty(n,t,{enumerable:!1,value:e}),e}var r;n?t=module.exports:(t.__npm__=t.__npm__||{},r=t.__npm__["async-watch"]={});var a=n?process.nextTick:t.requestAnimationFrame,c=0,u={jobs:{},_signed:{},subscriptions:{},scheduled:!1,__subscribers:function(n){for(var t in n)if(n.hasOwnProperty(t)){n[t].fn.apply(null,[n[t].values])}},__digest:function(){var n=this;n.scheduled===!1&&(n.scheduled=!0,a(function(){n.scheduled=!1;for(var t in n.jobs)n.jobs[t](),delete n.jobs[t];var e={};for(var t in n._signed){var s=n._signed[t],i=s.target();if(s.signed.apply(null,i),n.subscriptions[t]){var r=n.subscriptions[t].$id;e[r]=e[r]||{values:{},fn:n.subscriptions[t]},e[r].values[s.signed.$path]=i[0]}delete n._signed[t]}n.__subscribers(e)}))},signFunction:function(n){n.$id=n.$id||c++},subscribe:function(n,t){this.signFunction(t);for(var e=0;e<n.length;e++){var s=n[e];this.subscriptions[s.fn.$id]=t}},unsubscribe:function(n){for(var t=0;t<n.length;t++){var e=n[t];delete this.subscriptions[e.fn.$id]}},sign:function(n,t){return this.signFunction(n),n.$instant?n.apply(null,t()):(this._signed[n.$id]={target:t,signed:n},this.__digest())},cancel:function(n){delete this._signed[n.$id]},add:function(n,t,e){return t=e?t.bind(e):t,this.jobs[n]=t,this.__digest()}},o=function(n,t){return u.subscribe(n,t),{unsubscribe:function(){return u.unsubscribe(n)},destroy:function(){u.unsubscribe(n);for(var t in n){var e=n[t];e.destroy()}}}},f=0,d=function(n,t,r,a){if("object"==typeof n&&"function"==typeof r){var o=e(t);if(o){r.$id=r.$id||c++,a&&(r.$instant=!0);var p=o.path,h=o.str;r.$path=h;for(var l=p[0],b=[],$=0;$<p.length;$++)b.push(p[$]);var v,g=b.splice(1,b.length),y=g.join("."),_=l===h,A=n.$$p;A||(i(n,"$$p",{}),A=n.$$p,i(A,"$properties",{}),i(A,"$id",++f)),void 0===v&&(v=A.$id);var m=A.$properties[l];if(!m){m=A.$properties[l]={$self:[],$descendants:{}};var j=n[l];Object.defineProperty(n,l,{get:function(){return j},set:function(n){return k(n,j),j=n}});var k=function(n,t){for(var e in m.$descendants)if(m.$descendants.hasOwnProperty(e)){for(var i in m.$descendants[e].callbacks){var r=m.$descendants[e].callbacks[i];u.sign(r,function(){return[s(n,e),t]})}u.add(v+e,function(){m.$descendants[this.key].bindWatcher()},{key:e})}if(_)for(var i=0;i<m.$self.length;i++){var a=m.$self[i];a.$path&&"object"==typeof t&&(t=s(t,a.$path)),u.sign(a,function(){return[n,t]})}}}_?(u.sign(r,function(){return[n[l]]}),m.$self.push(r)):(m.$descendants[y]?m.$descendants[y].callbacks.push(r):(m.$descendants[y]={callbacks:[r],bindWatcher:function(){n.hasOwnProperty(l)&&void 0!==n[l]&&d(n[l],g,function(n,t){for(var e=0;e<m.$descendants[y].callbacks.length;e++){var s=m.$descendants[y].callbacks[e];u.sign(s,function(){return[n,t]})}},!0)}},m.$descendants[y].bindWatcher()),u.sign(r,function(){return[s(n[l],g)]}));var w=m.$descendants[y];return{fn:r,destroy:function(){if(w){var n=w.callbacks.indexOf(r);n>-1&&w.callbacks.splice(n,1)}if(m.$self){var t=m.$self.indexOf(r);t>-1&&m.$self.splice(n,1)}}}}}},h=function(n,t,e,s){for(var i=[],r=0;r<e.length;r++){var a=e[r];i.push(d(n,a,function(){}))}return o(i,function(){n[t]=s.bind(n)(n)})},l=function(n,t,e,s){var r=[];return d(n,t,function(n,t){n.$$p||(n.$$p=p=i(n,"$pp",{}));var s=n.$$p.array;return s||(s=i(p,"array",{})),s.watchers||(s.watchers=i(s,"fn",[])),s.watchers.push(e),s.init||(s.init=!0,s.changed=function(t){if(t.length>0)for(var e=0;e<s.watchers.length;e++)s.watchers[e](n,r);r=[]},n.push=function(){Array.prototype.push.apply(this,arguments);var n=arguments;r.push({name:"push",data:n}),u.sign(s.changed,function(){return[r]})},n.splice=function(){var n=arguments;Array.prototype.splice.apply(this,arguments),r.push({name:"splice",data:n}),u.sign(s.changed,function(){return[r]})},n.unshift=function(){var n=arguments;Array.prototype.unshift.apply(this,n),r.push({name:"unshift",data:n}),u.sign(s.changed,function(){return[r]})}),r=[],e(n,[{name:"init"}])},s)};d.subscribe=o,d.computed=h,t.AsyncWatch=d,t.AsyncSubscribe=o,t.AsyncComputed=h,t.AsyncWatchArray=l,t.AsyncTransaction=u,r&&(r.AsyncWatch=d,r.AsyncSubscribe=AsyncSubscribe,r.AsyncWatchArray=l,r.AsyncTransaction=u)}("undefined"!=typeof module&&module.exports,this);