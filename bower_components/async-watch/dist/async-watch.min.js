!function(n,e){function s(n){if(n instanceof Array)return{path:n,str:n.join(".")};if("string"==typeof n)return{path:n.split("."),str:n}}function i(n,e){if(0!==e.length&&void 0!==n){var i=s(e);if(i){e=i.path;for(var t=0;t<e.length;t++)if(n=n[e[t]],void 0===n)return;return n}}}function t(n,e,s){return Object.defineProperty(n,e,{enumerable:!1,value:s}),n}n&&(e=module.exports);var r=n?process.nextTick:e.requestAnimationFrame,c=0,a={jobs:{},_signed:{},subscriptions:{},scheduled:!1,__subscribers:function(n){for(var e in n)if(n.hasOwnProperty(e)){n[e].fn.apply(null,[n[e].values])}},__digest:function(){var n=this;n.scheduled===!1&&(n.scheduled=!0,r(function(){for(var e in n.jobs)n.jobs[e](),delete n.jobs[e];var s={};for(var e in n._signed){var i=n._signed[e],t=i.target();if(i.signed.apply(null,t),n.subscriptions[e]){var r=n.subscriptions[e].$id;s[r]=s[r]||{values:{},fn:n.subscriptions[e]},s[r].values[i.signed.$path]=t[0]}delete n._signed[e]}n.__subscribers(s),n.scheduled=!1}))},signFunction:function(n){n.$id=n.$id||c++},subscribe:function(n,e){this.signFunction(e);for(var s=0;s<n.length;s++){var i=n[s];this.subscriptions[i.fn.$id]=e}},unsubscribe:function(n){for(var e=0;e<n.length;e++){var s=n[e];delete this.subscriptions[s.fn.$id]}},sign:function(n,e){return this.signFunction(n),n.$instant?n.apply(null,e()):(this._signed[n.$id]={target:e,signed:n},this.__digest())},add:function(n,e,s){return e=s?e.bind(s):e,this.jobs[n]=e,this.__digest()}},u=function(n,e){return a.subscribe(n,e),{unsubscribe:function(){return a.unsubscribe(n)},destroy:function(){a.unsubscribe(n);for(var e in n){var s=n[e];s.destroy()}}}},o=0,d=function(n,e,r,u){if("object"==typeof n&&"function"==typeof r){var f=s(e);if(f){r.$id?r.$id:c++,u&&(r.$instant=!0);var l=f.path,p=f.str;r.$path=p;for(var b=l[0],$=[],v=0;v<l.length;v++)$.push(l[v]);var h,g=$.splice(1,$.length),y=g.join("."),_=b===p,k=n.$$p;k||(t(n,"$$p",{}),k=n.$$p,t(k,"$properties",{}),t(k,"$id",++o)),void 0===h&&(h=k.$id);var j=k.$properties[b];if(!j){j=k.$properties[b]={$self:[],$descendants:{}};var O=n[b];Object.defineProperty(n,b,{get:function(){return O},set:function(n){return m(n,O),O=n}});var m=function(n,e){for(var s in j.$descendants)if(j.$descendants.hasOwnProperty(s)){for(var t in j.$descendants[s].callbacks){var r=j.$descendants[s].callbacks[t];a.sign(r,function(){return[i(n,s),e]})}a.add(h+s,function(){j.$descendants[this.key].bindWatcher()},{key:s})}if(_)for(var t=0;t<j.$self.length;t++){var c=j.$self[t];a.sign(c,function(){return[n,e]})}}}_?(a.sign(r,function(){return[n[b]]}),j.$self.push(r)):(j.$descendants[y]?j.$descendants[y].callbacks.push(r):(j.$descendants[y]={callbacks:[r],bindWatcher:function(){n.hasOwnProperty(b)&&void 0!==n[b]&&d(n[b],g,function(n,e){for(var s=0;s<j.$descendants[y].callbacks.length;s++){var i=j.$descendants[y].callbacks[s];a.sign(i,function(){return[n,e]})}},!0)}},j.$descendants[y].bindWatcher()),a.sign(r,function(){return[i(n[b],g)]}));var x=j.$descendants[y];return{fn:r,destroy:function(){if(x){var n=x.callbacks.indexOf(r);n>-1&&x.callbacks.splice(n,1)}if(j.$self){var e=j.$self.indexOf(r);e>-1&&j.$self.splice(n,1)}}}}}};d.subscribe=u,e.AsyncWatch=d,e.AsyncTransaction=a}("undefined"!=typeof module&&module.exports,this);